<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ì–∞–ª–µ—Ä–µ—è - –¢–µ—Å—Ç–æ–≤—ã–π —Å–∞–π—Ç</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>–ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (GET/DELETE)</h1>
    
    <div class="nav-menu">
      <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="upload.html">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (POST)</a>
      <a href="gallery.html" class="active">–ì–∞–ª–µ—Ä–µ—è (GET/DELETE)</a>
      <a href="test-api.html">API —Ç–µ—Å—Ç—ã</a>
    </div>
    
    <div class="content-box">
      <h2>–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏</h2>
      
      <div class="gallery-controls">
        <button id="refresh-gallery">–û–±–Ω–æ–≤–∏—Ç—å –≥–∞–ª–µ—Ä–µ—é</button>
      </div>
      
      <div id="gallery" class="gallery-container">
        <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...</div>
      </div>
    </div>
  </div>
  
  <script>
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
    function loadGallery() {
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...</div>';
      
      fetch('/uploads/')
        .then(response => response.text())
        .then(html => {
          // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é, –º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å HTML
          // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JSON API
          
          // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
          const files = [
            { name: 'example1.jpg', path: '/uploads/example1.jpg' },
            { name: 'example2.png', path: '/uploads/example2.png' },
            { name: 'example3.gif', path: '/uploads/example3.gif' }
          ];
          
          if (files.length === 0) {
            gallery.innerHTML = '<div class="no-files">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>';
            return;
          }
          
          gallery.innerHTML = '';
          
          files.forEach(file => {
            const item = document.createElement('div');
            item.className = 'gallery-item';
            
            // –î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            if (/\.(jpg|jpeg|png|gif|webp|svg)$/i.test(file.name)) {
              item.innerHTML = `
                <div class="image-container">
                  <img src="${file.path}" alt="${file.name}">
                </div>
                <div class="file-info">
                  <span class="file-name">${file.name}</span>
                  <div class="file-actions">
                    <a href="${file.path}" target="_blank" class="view-btn">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                    <button class="delete-btn" data-file="${file.path}">–£–¥–∞–ª–∏—Ç—å</button>
                  </div>
                </div>
              `;
            } else {
              item.innerHTML = `
                <div class="file-icon">üìÑ</div>
                <div class="file-info">
                  <span class="file-name">${file.name}</span>
                  <div class="file-actions">
                    <a href="${file.path}" target="_blank" class="view-btn">–°–∫–∞—á–∞—Ç—å</a>
                    <button class="delete-btn" data-file="${file.path}">–£–¥–∞–ª–∏—Ç—å</button>
                  </div>
                </div>
              `;
            }
            
            gallery.appendChild(item);
          });
          
          // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
          document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', function() {
              const filePath = this.getAttribute('data-file');
              deleteFile(filePath, this.closest('.gallery-item'));
            });
          });
        })
        .catch(error => {
          gallery.innerHTML = `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤: ${error}</div>`;
        });
    }
    
    // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞
    function deleteFile(filePath, itemElement) {
      if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª?`)) {
        itemElement.classList.add('deleting');
        
        fetch(filePath, {
          method: 'DELETE'
        })
        .then(response => {
          if (response.ok) {
            itemElement.remove();
            if (document.querySelectorAll('.gallery-item').length === 0) {
              document.getElementById('gallery').innerHTML = '<div class="no-files">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>';
            }
          } else {
            throw new Error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${response.status}`);
          }
        })
        .catch(error => {
          itemElement.classList.remove('deleting');
          alert(`–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª: ${error}`);
        });
      }
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–∞–ª–µ—Ä–µ—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', loadGallery);
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–∞–ª–µ—Ä–µ–∏ –ø–æ –∫–Ω–æ–ø–∫–µ
    document.getElementById('refresh-gallery').addEventListener('click', loadGallery);
  </script>
</body>
</html>